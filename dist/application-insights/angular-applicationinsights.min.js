/*! angular-applicationinsights version 0.2.8 2016-01-29 */
!function(a){var b=function(){function a(b){a.isDefined=b.isDefined,a.isUndefined=b.isUndefined,a.isObject=b.isObject,a.isArray=b.isArray,a.isString=b.isString,a.extend=b.extend,a.toJson=b.toJson,a.fromJson=b.fromJson,a.forEach=b.forEach,a.noop=b.noop}return a.isNullOrUndefined=function(b){return a.isUndefined(b)||null===b},a.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},a.generateGuid=function(){for(var a=[],b="0123456789abcdef",c=0;36>c;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[8]=a[13]=a[18]=a[23]="-",a[14]="4",a[19]=b.substr(3&a[19]|8,1),a.join("")},a}(),c=function(){function a(c){var d=this;this._config=b.extend(a.defaultConfig,c),this._self=this._config,this._prefix=this._config.prefix,this._cookie=this._config.cookie,this._notify=this._config.notify,this._storageType=this._config.storageType,this._$rootScope=this._config.rootScope,this._$window=this._config.window,this._$document=this._config.document,this._$parse=this._config.parse,this._$document?this._$document[0]&&(this._$document=this._$document[0]):this._$document=document,"."!==this._prefix.substr(-1)&&(this._prefix=this._prefix?this._prefix+".":""),this._deriveQualifiedKey=function(a){return d._prefix+a}}return a.prototype.isStringNumber=function(a){return/^-?\d+\.?\d*$/.test(a.replace(/["']/g,""))},a.prototype.browserSupportsLocalStorage=function(){try{var a=this._storageType in this._$window&&null!==this._$window[this._storageType],b=this._deriveQualifiedKey("__"+Math.round(1e7*Math.random()));return a&&(this._webStorage=this._$window[this._storageType],this._webStorage.setItem(b,""),this._webStorage.removeItem(b)),a}catch(c){return this._storageType="cookie",this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error",c.message),!1}},a.prototype.browserSupportsCookies=function(){try{return this._$window.navigator.cookieEnabled||"cookie"in this._$document&&(this._$document.cookie.length>0||(this._$document.cookie="test").indexOf.call(this._$document.cookie,"test")>-1)}catch(a){return this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error",a.message),!1}},a.prototype.addToCookies=function(a,c){if(b.isUndefined(c))return!1;if((b.isArray(c)||b.isObject(c))&&(c=b.toJson(c)),!this.browserSupportsCookies)return this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var d="",e=new Date,f="";if(null===c?(e.setTime(e.getTime()+-864e5),d="; expires="+e.toUTCString(),c=""):0!==this._cookie.expiry&&(e.setTime(e.getTime()+24*this._cookie.expiry*60*60*1e3),d="; expires="+e.toUTCString()),a){var g="; path="+this._cookie.path;this._cookie.domain&&(f="; domain="+this._cookie.domain),this._$document.cookie=this._deriveQualifiedKey(a)+"="+encodeURIComponent(c)+d+g+f}}catch(h){return this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error",h.message),!1}return!0},a.prototype.getFromCookies=function(a){if(!this.browserSupportsCookies)return this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=this._$document.cookie&&this._$document.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(this._deriveQualifiedKey(a)+"=")){var f=decodeURIComponent(e.substring(this._prefix.length+a.length+1,e.length));try{var g=JSON.parse(f);return b.fromJson(g)}catch(h){return f}}}return null},a.prototype.addToLocalStorage=function(a,c){if(b.isUndefined(c)?c=null:(b.isObject(c)||b.isArray(c)||b.isNumber(+c||c))&&(c=b.toJson(c)),!this.browserSupportsLocalStorage()||"cookie"===this._self.storageType)return this.browserSupportsLocalStorage()||this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),this._notify.setItem&&this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.setitem",{key:a,newvalue:c,storageType:"cookie"}),this.addToCookies(a,c);try{(b.isObject(c)||b.isArray(c))&&(c=b.toJson(c)),this._webStorage&&this._webStorage.setItem(this._deriveQualifiedKey(a),c),this._notify.setItem&&this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.setitem",{key:a,newvalue:c,storageType:this._self.storageType})}catch(d){return this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error",d.message),this.addToCookies(a,c)}return!0},a.prototype.getFromLocalStorage=function(a){if(!this.browserSupportsLocalStorage()||"cookie"===this._self.storageType)return this.browserSupportsLocalStorage()||this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),this.getFromCookies(a);var c=this._webStorage?this._webStorage.getItem(this._deriveQualifiedKey(a)):null;return c&&"null"!==c?"{"===c.charAt(0)||"["===c.charAt(0)||this.isStringNumber(c)?b.fromJson(c):c:null},a.prototype.getStorageType=function(){return this._storageType},a.prototype.isSupported=function(){return this.browserSupportsLocalStorage()},a.prototype.set=function(a,b){return this.addToLocalStorage(a,b)},a.prototype.get=function(a){return this.getFromLocalStorage(a)},a.prototype.deriveKey=function(a){return this._deriveQualifiedKey(a)},a.prototype.isCookiesSupported=function(){return this.browserSupportsCookies()},a.prototype.setCookie=function(a,b){this.addToCookies(a,b)},a.prototype.getCookie=function(a){return this.getFromCookies(a)},a.defaultConfig={prefix:"ls",storageType:"localStorage",cookie:{expiry:30,path:"/"},notify:{setItem:!0,removeItem:!1}},a}(),d=(function(){function a(){}return a}(),function(){function a(){}return a}(),function(){function a(a,c,d,e,f,g){b.isUndefined(a)||this.setFunctionName(a),b.isUndefined(f)||this.setColumnNumber(f),b.isUndefined(c)||this.setArgs(c),b.isUndefined(d)||this.setFileName(d),b.isUndefined(e)||this.setLineNumber(e),b.isUndefined(g)||this.setLevelNumber(g)}return a.prototype.setFunctionName=function(a){this.method=String(a)},a.prototype.setArgs=function(a){if("[object Array]"!==Object.prototype.toString.call(a))throw new TypeError("Args must be an Array");this.args=a},a.prototype.setFileName=function(a){this.fileName=String(a)},a.prototype.setLineNumber=function(a){return b.isNumber(a)?void(this.lineNumber=Number(a)):void(this.lineNumber=void 0)},a.prototype.setColumnNumber=function(a){return b.isNumber(a)?void(this.columnNumber=Number(a)):void(this.columnNumber=void 0)},a.prototype.setLevelNumber=function(a){if(!b.isNumber(a))throw new TypeError("Level Number must be a Number");this.level=Number(a)},a.prototype.toString=function(){var a=this.method||"{anonymous}",c="("+(this.args||[]).join(",")+")",d=this.fileName?"@"+this.fileName:"",e=b.isNumber(this.lineNumber)?":"+this.lineNumber:"",f=b.isNumber(this.columnNumber)?":"+this.columnNumber:"";return a+c+d+e+f},a}()),e=function(){function a(){}return a.parse=function(b){return"undefined"!=typeof b.stacktrace||"undefined"!=typeof b["opera#sourceloc"]?a.parseOpera(b):b.stack&&b.stack.match(a.chromeIeStackRegexp)?a.parseChromeOrInternetExplorer(b):b.stack&&b.stack.match(a.firefoxSafariStackRegexp)?a.parseFireFoxOrSafari(b):null},a.extractLocation=function(a){if(-1===a.indexOf(":"))return[];var b=a.split(":"),c=b.pop(),d=b[b.length-1];if(!isNaN(parseFloat(d))&&isFinite(d)){var e=b.pop();return[b.join(":"),e,c]}return[b.join(":"),c,void 0]},a.parseChromeOrInternetExplorer=function(a){var b=this,c=0;return a.stack.split("\n").slice(1).map(function(a){var e=a.replace(/^\s+/,"").split(/\s+/).slice(1),f=void 0!==e[0]?b.extractLocation(e.pop().replace(/[\(\)\s]/g,"")):["unknown","unknown","unknown"],g=e[0]&&"Anonymous"!==e[0]?e[0]:"unknown";return new d(g,void 0,f[0],f[1],f[2],c++)},this)},a.parseFireFoxOrSafari=function(b){var c=this,e=0;return b.stack.split("\n").filter(function(b){return!!b.match(a.firefoxSafariStackRegexp)},this).map(function(a){var b=a.split("@"),f=c.extractLocation(b.pop()),g=b.shift()||"unknown";return new d(g,void 0,f[0],f[1],f[2],e++)},this)},a.parseOpera=function(a){return!a.stacktrace||a.message.indexOf("\n")>-1&&a.message.split("\n").length>a.stacktrace.split("\n").length?this.parseOpera9(a):a.stack?this.parseOpera11(a):this.parseOpera10(a)},a.parseOpera9=function(a){for(var b=/Line (\d+).*script (?:in )?(\S+)/i,c=a.message.split("\n"),e=[],f=2,g=c.length;g>f;f+=2){var h=b.exec(c[f]);if(h){var i=0;e.push(new d(void 0,void 0,h[2],h[1],void 0,i++))}}return e},a.parseOpera10=function(a){for(var b=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,c=a.stacktrace.split("\n"),e=[],f=0,g=c.length;g>f;f+=2){var h=b.exec(c[f]);if(h){var i=0;e.push(new d(h[3]||void 0,void 0,h[2],h[1],void 0,i++))}}return e},a.parseOpera11=function(b){var c=0;return b.stack.split("\n").filter(function(b){return!!b.match(a.firefoxSafariStackRegexp)&&!b.match(/^Error created at/)},this).map(function(b){var e,f=b.split("@"),g=a.extractLocation(f.pop()),h=f.shift()||"",i=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;h.match(/\(([^\)]*)\)/)&&(e=h.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var j=void 0===e||"[arguments not available]"===e?void 0:e?e.split(","):"";return new d(i,j,g[0],g[1],g[2],c++)},this)},a.firefoxSafariStackRegexp=/\S+\:\d+/,a.chromeIeStackRegexp=/\s+at /,a}(),f=function(){function a(b,c){var d=this;this._angular=c,this._noop=this._angular.noop,a.interceptFuntion=this._noop,b.decorator("$log",["$delegate",function(a){return d._debugFn=a.debug,d._infoFn=a.info,d._warnFn=a.warn,d._errorFn=a.error,d._logFn=a.log,a.debug=d.delegator(d._debugFn,"debug"),a.info=d.delegator(d._infoFn,"info"),a.warn=d.delegator(d._warnFn,"warn"),a.error=d.delegator(d._errorFn,"error"),a.log=d.delegator(d._logFn,"log"),a}])}return a.prototype.setInterceptFunction=function(b){a.interceptFuntion=b},a.prototype.getPrivateLoggingObject=function(){return{debug:b.isNullOrUndefined(this._debugFn)?b.noop:this._debugFn,info:b.isNullOrUndefined(this._infoFn)?b.noop:this._infoFn,warn:b.isNullOrUndefined(this._warnFn)?b.noop:this._warnFn,error:b.isNullOrUndefined(this._errorFn)?b.noop:this._errorFn,log:b.isNullOrUndefined(this._logFn)?b.noop:this._logFn}},a.prototype.delegator=function(b,c){return function(){var d=[].slice.call(arguments);a.interceptFuntion(d[0],c),b.apply(null,d)}},a}(),g=function(){function a(c){var d=this;a.errorOnHttpCall=!1,this._interceptFunction=b.noop,c.decorator("$exceptionHandler",["$delegate",function(b){return d._origExceptionHandler=b,function(b,c){a.errorOnHttpCall||d._interceptFunction(b,c),d._origExceptionHandler(b,c)}}])}return a.prototype.setInterceptFunction=function(a){this._interceptFunction=a},a.prototype.getPrivateExceptionHanlder=function(){return b.isNullOrUndefined(this._origExceptionHandler)?b.noop:this._origExceptionHandler},a}(),h=function(){function a(){this.applicationName="",this.autoPageViewTracking=!0,this.autoLogTracking=!0,this.autoExceptionTracking=!0,this.sessionInactivityTimeout=18e5,this.instrumentationKey=""}return a}(),i=function(){function a(){}return a.prototype.send=function(a,b,c){var d=new XMLHttpRequest;d.onerror=function(){c(0)},d.onload=function(){200==d.status?b():c(d.status)},d.open(a.method,a.url,!0);for(var e in a.headers)d.setRequestHeader(e,a.headers[e]);d.send(JSON.stringify(a.data))},a}(),j=(function(){function a(){}return a}(),function(){function a(a,b,c,d,e,f,g,h){var i=this;this._sessionKey="$$appInsights__session",this._version="angular:0.2.8",this._analyticsServiceUrl="https://dc.services.visualstudio.com/v2/track",this._contentType="application/json",this._localStorage=a,this._locale=b,this._window=c,this._location=d,this._httpRequestFactory=g,this.options=h,this._log=e.getPrivateLoggingObject(),this._exceptionHandler=f.getPrivateExceptionHanlder(),this._logInterceptor=e,this._exceptionInterceptor=f,this.options.autoLogTracking&&this._logInterceptor.setInterceptFunction(function(a,b,c){return i.trackTraceMessage(a,b,c)}),this.options.autoExceptionTracking&&this._exceptionInterceptor.setInterceptFunction(function(a,b){return i.trackException(a,b)})}return a.prototype.getUniqueId=function(){var a="$$appInsights__uuid",c=this._localStorage.get(a);return b.isNullOrUndefined(c)&&(c=b.generateGuid(),this._localStorage.set(a,c)),c},a.prototype.makeNewSession=function(){var a={id:b.generateGuid(),accessed:(new Date).getTime()};return this._localStorage.set(this._sessionKey,a),a},a.prototype.getSessionId=function(){var a=this._localStorage.get(this._sessionKey);if(b.isNullOrUndefined(a))a=this.makeNewSession();else{var c=b.isNullOrUndefined(a.accessed)?0:a.accessed,d=(new Date).getTime();d-c>this.options.sessionInactivityTimeout?a=this.makeNewSession():(a.accessed=d,this._localStorage.set(this._sessionKey,a))}return a.id},a.prototype.validateMeasurements=function(a){if(b.isNullOrUndefined(a))return null;if(!b.isObject(a))return this._log.warn("The value of the measurements parameter must be an object consisting of a string/number pairs."),null;var c={};for(var d in a)b.isNumber(a[d])?c[d]=a[d]:this._log.warn("The value of measurement "+d+" is not a number.");return c},a.prototype.validateProperties=function(a){if(b.isNullOrUndefined(a))return null;if(!b.isObject(a))return this._log.warn("The value of the properties parameter must be an object consisting of a string/string pairs."),null;var c={};for(var d in a){var e=a[d];b.isNullOrUndefined(e)||b.isObject(e)||b.isArray(e)?this._log.warn("The value of property "+d+" could not be determined to be a string or number."):c[d]=e}return c},a.prototype.validateSeverityLevel=function(a){var b=["debug","info","warn","error"],c=b.indexOf(a);return c>-1?c:0},a.prototype.sendData=function(a){var b=this._httpRequestFactory(),c={};c.Accept=this._contentType,c["Content-Type"]=this._contentType;var d={method:"POST",url:this._analyticsServiceUrl,headers:c,data:a};try{b.send(d,function(){g.errorOnHttpCall=!1},function(){g.errorOnHttpCall=!0})}catch(e){}},a.prototype.trackPageView=function(c,d,e,f){var g=this.generateAppInsightsData(a.names.pageViews,a.types.pageViews,{ver:1,url:b.isNullOrUndefined(d)?this._location.absUrl():d,name:b.isNullOrUndefined(c)?this._location.path():c,properties:this.validateProperties(e),measurements:this.validateMeasurements(f)});this.sendData(g)},a.prototype.trackEvent=function(b,c,d){var e=this.generateAppInsightsData(a.names.events,a.types.events,{ver:1,name:b,properties:this.validateProperties(c),measurements:this.validateMeasurements(d)});this.sendData(e)},a.prototype.trackTraceMessage=function(c,d,e){if(!b.isNullOrUndefined(c)&&b.isString(c)){var f=this.generateAppInsightsData(a.names.traceMessage,a.types.traceMessage,{ver:1,message:c,severityLevel:this.validateSeverityLevel(d),properties:this.validateProperties(e)});this.sendData(f)}},a.prototype.trackMetric=function(b,c,d){var e=this.generateAppInsightsData(a.names.metrics,a.types.metrics,{ver:1,metrics:[{name:b,value:c}],properties:this.validateProperties(d)});this.sendData(e)},a.prototype.trackException=function(c){if(!b.isNullOrUndefined(c)){var d=e.parse(c),f=this.generateAppInsightsData(a.names.exception,a.types.exception,{ver:1,handledAt:"Unhandled",exceptions:[{typeName:c.name,message:c.message,stack:c.stack,parsedStack:d,hasFullStack:!b.isNullOrUndefined(d)}]});this.sendData(f)}},a.prototype.generateAppInsightsData=function(a,c,d){return this._commonProperties&&(d.properties=d.properties||{},b.extend(d.properties,this._commonProperties)),{name:a,time:(new Date).toISOString(),ver:1,iKey:this.options.instrumentationKey,user:{id:this.getUniqueId(),type:"User"},session:{id:this.getSessionId()},operation:{id:b.generateGuid()},device:{id:"browser",locale:this._locale.id,resolution:this._window.screen.availWidth+"x"+this._window.screen.availHeight,type:"Browser"},internal:{sdkVersion:this._version},data:{type:c,item:d}}},a.prototype.setCommonProperties=function(a){this.validateProperties(a),this._commonProperties=this._commonProperties||{},b.extend(this._commonProperties,a)},a.namespace="Microsoft.ApplicationInsights.",a.names={pageViews:a.namespace+"Pageview",traceMessage:a.namespace+"Message",events:a.namespace+"Event",metrics:a.namespace+"Metric",exception:a.namespace+"Exception"},a.types={pageViews:a.namespace+"PageViewData",traceMessage:a.namespace+"MessageData",events:a.namespace+"EventData",metrics:a.namespace+"MetricData",exception:a.namespace+"ExceptionData"},a}()),k=a.module("$$ApplicationInsights-HttpRequestModule",[]);k.factory("$$applicationInsightsHttpRequestService",function(){return function(){return new i}});{var l,m,n=a.module("ApplicationInsightsModule",["$$ApplicationInsights-HttpRequestModule"]);new b(a)}n.config(["$provide",function(b){l=new f(b,a),m=new g(b)}]),n.provider("applicationInsightsService",function(){return new o}),n.run(["$rootScope","$location","applicationInsightsService",function(a,b,c){a.$on("$locationChangeSuccess",function(){c.options.autoPageViewTracking&&c.trackPageView(c.options.applicationName+b.path())})}]);var o=function(){function a(){var a=this;this._options=new h,this.$get=["$locale","$window","$location","$rootScope","$parse","$document","$$applicationInsightsHttpRequestService",function(b,d,e,f,g,h,i){var k=new c({window:d,rootScope:f,document:h,parse:g});return new j(k,b,d,e,l,m,i,a._options)}]}return a.prototype.configure=function(a,c,d){b.isString(c)?(this._options.instrumentationKey=a,this._options.applicationName=c,this._options.autoPageViewTracking=b.isNullOrUndefined(d)?!0:d):(b.extend(this._options,c),this._options.instrumentationKey=a)},a}()}(window.angular);